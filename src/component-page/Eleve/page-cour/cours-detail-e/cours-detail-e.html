<app-header-e></app-header-e>

<!-- ======================= PAGE ENTIÈRE ======================= -->
<div class="max-w-[95vw] w-full mx-auto px-8 py-10 mt-16 font-sans">

  <!-- ======================= FLEX 3 BLOCS ======================= -->
  <div class="flex flex-col lg:flex-row gap-10 justify-between">

    <!-- ======================= BARRE OUTIL ======================= -->
    <div class="flex-[1] min-w-0 bg-[var(--Bleu)] text-[var(--Blanc)] rounded-3xl shadow-2xl 
                border-2 border-[var(--Violet)] p-6">
      <h2 class="text-2xl font-extrabold mb-6 text-center text-[var(--Jaune)] drop-shadow-lg">
        <i class="fa-solid fa-universal-access"></i> Barre d’outils DYS
      </h2>
      <div class="space-y-6">
        <div class="flex items-center gap-6">
          <button
            (click)="diminuerTexte()"
            class="p-3 bg-[var(--Violet)] rounded-full transition-colors duration-200 hover:bg-[var(--Violet-Foncé)] focus:outline-none focus:ring-2 focus:ring-[var(--Jaune)]"
            aria-label="Réduire la taille du texte">
            <i class="fas fa-minus"></i>
          </button>
          <span class="font-semibold">Taille : {{ texteTaille }}px</span>
          <button
            (click)="augmenterTexte()"
            class="p-3 bg-[var(--Violet)] rounded-full transition-colors duration-200 hover:bg-[var(--Violet-Foncé)] focus:outline-none focus:ring-2 focus:ring-[var(--Jaune)]"
            aria-label="Augmenter la taille du texte">
            <i class="fas fa-plus"></i>
          </button>
        </div>
        <div class="flex items-center gap-4">
          <label class="font-semibold" for="police-select">Police&nbsp;:</label>
          <select
            id="police-select"
            [(ngModel)]="policeTexte"
            (change)="changerPolice()"
            class="p-2 rounded-lg bg-[var(--Violet)] text-[var(--Blanc)] focus:outline-none focus:ring-2 focus:ring-[var(--Jaune)]">
            <option *ngFor="let font of policesDisponibles" [value]="font">{{ font }}</option>
          </select>
        </div>
      </div>
    </div>

    <!-- ======================= COURS ======================= -->
    <div class="flex-[3] min-w-0 bg-[var(--Bleu)] text-[var(--Blanc)] rounded-3xl shadow-2xl 
                border-2 border-[var(--Violet)] p-6">
      <h2 class="text-2xl font-extrabold mb-6 text-center text-[var(--Violet)] drop-shadow-lg">
        <i class="fa-solid fa-book-open"></i> Cours
      </h2>
      <div [ngStyle]="{'font-size.px': texteTaille, 'font-family': policeTexte}">
        <section
          *ngIf="contenuHtml"
          [innerHTML]="contenuHtml"
          class="prose prose-invert max-w-none leading-relaxed [&_img]:mx-auto [&_img]:my-4 [&_img]:rounded-xl [&_p]:text-justify">
        </section>
        <div *ngIf="loading" class="flex justify-center items-center p-8">
          <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-[var(--Blanc)]"></div>
          <span class="ml-4 text-[var(--Jaune)]">Chargement du contenu...</span>
        </div>
        <div *ngIf="!loading && !contenuHtml" class="text-center p-8 text-gray-400">
          Aucun contenu disponible
        </div>
      </div>
    </div>

    <!-- ======================= QCM ======================= -->
    <div class="flex-[2] min-w-0 bg-[var(--Bleu)] rounded-3xl shadow-2xl 
                border-2 border-[var(--Violet)] p-8">
      <h2 class="text-2xl font-extrabold mb-6 text-center text-[var(--Jaune)] drop-shadow-lg">
        <i class="fa-solid fa-clipboard-list"></i> QCM
      </h2>
      <section *ngIf="qcm.length > 0"
               class="p-6 bg-gradient-to-b from-[var(--Bleu)] to-[var(--Violet)] rounded-xl shadow-xl border-4 border-[var(--Violet)]">
        <div class="flex justify-between items-center mb-4">
          <span class="text-[var(--Jaune)] font-semibold text-xl">XP total : {{ xptotal }} XP</span>
        </div>
        <form
          (ngSubmit)="validerQCM()" #qcmForm="ngForm" novalidate
          class="space-y-8">
          <fieldset
            *ngFor="let question of qcm; let questionIndex = index"
            [ngClass]="{
              'bg-green-900/20 border-l-4 border-[var(--Vert)]': resultat !== null && questionEstJuste(questionIndex),
              'bg-red-900/20 border-l-4 border-[var(--Rouge)]': resultat !== null && !questionEstJuste(questionIndex),
              'bg-[var(--Bleu)] border border-[var(--Violet)]/40': resultat === null
            }"
            class="rounded-xl p-6">
            <legend class="text-lg font-bold mb-4 flex justify-between items-center">
              <span class="text-[var(--Jaune)]">{{ questionIndex + 1 }}/{{ qcm.length }} - {{ question.question }}</span>
              <span class="text-[var(--Jaune)] font-semibold">{{ question.xp || 0 }} XP</span>
            </legend>
            <ul class="space-y-4">
              <li *ngFor="let reponse of question.reponses; let reponseIndex = index">
                <label class="flex items-center gap-4 px-4 py-3 rounded-lg cursor-pointer transition-colors duration-200"
                       [ngClass]="{
                         'bg-[var(--Vert)] text-white font-semibold': resultat !== null && isBonneReponse(question, reponseIndex),
                         'bg-[var(--Rouge)] text-white line-through': resultat !== null && estCoche(questionIndex, reponseIndex) && !isBonneReponse(question, reponseIndex),
                         'bg-white/10 text-white hover:bg-white/20': resultat === null
                       }">
                  <input type="radio"
                         name="qcm_{{ questionIndex }}"
                         [value]="reponseIndex"
                         [(ngModel)]="reponsesUtilisateur[questionIndex]"
                         [disabled]="qcmDejaFait || resultat !== null" />
                  <span>{{ reponse }}</span>
                </label>
              </li>
            </ul>
          </fieldset>
          <div class="flex justify-center mt-8">
            <button
              *ngIf="!qcmDejaFait"
              type="submit"
              class="px-8 py-3 bg-[var(--Violet)] text-white rounded-full transition-colors duration-200 hover:bg-[var(--Violet-Foncé)] focus:outline-none focus:ring-2 focus:ring-[var(--Jaune)]">
              Valider mes réponses
            </button>
            <button
              *ngIf="qcmDejaFait"
              type="button"
              (click)="showPopup = true"
              class="px-8 py-3 border-2 border-[var(--Jaune)] text-white rounded-full transition-colors duration-200 hover:bg-[var(--Violet-Foncé)] focus:outline-none focus:ring-2 focus:ring-[var(--Jaune)]">
              Voir mes résultats
            </button>
          </div>
        </form>
      </section>
    </div>

  </div>
</div>



<!-- <div class="flex gap-6 mt-10 justify-center">
  <div class="bg-red-500 p-10 rounded-lg">
    <h1 class="text-white text-4xl text-center">Barre D'outil pour les dys ici</h1>
  </div>
  <div class="bg-red-500 p-10 rounded-lg">
    <h1 class="text-white text-4xl text-center">Cours du prof ici</h1>
  </div>
  <div class="bg-red-500 p-10 rounded-lg">
    <h1 class="text-white text-4xl text-center">Le QCM ici</h1>
  </div>
</div> -->