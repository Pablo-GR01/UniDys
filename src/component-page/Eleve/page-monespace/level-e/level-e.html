<div class="mt-16 min-h-[320px] pb-10 px-8 z-20 flex flex-col items-center justify-center rounded-2xl shadow-2xl max-w-md mx-auto bg-gradient-to-br from-purple-900 to-purple-700 border border-purple-600">

  <ng-container *ngIf="!isLoading; else loadingTemplate">

    <div *ngIf="user; else noUserTemplate" class="w-full text-center">

      <!-- XP -->
      <h2 class="text-white text-5xl font-extrabold mb-3 drop-shadow-lg tracking-wide flex items-center justify-center">
        {{ user?.xp }} XP
      </h2>

      <!-- Niveau -->
      <span class="px-6 py-2 rounded-full text-base font-semibold text-purple-50 bg-gradient-to-r from-purple-600 to-purple-800 shadow-lg mb-4 inline-block">
        Level : {{ level }}
      </span>

      <!-- Badge -->
      <div class="flex justify-center my-6">
        <div 
          [ngClass]="{
            'from-gray-400 to-gray-600': level <= 1,
            'from-blue-400 to-blue-700': level === 2,
            'from-yellow-300 to-yellow-500': level === 3,
            'from-orange-400 to-orange-600': level >= 4
          }"
          class="flex items-center justify-center w-28 h-28 rounded-2xl shadow-2xl text-white text-5xl font-extrabold relative before:absolute before:inset-0 before:rounded-2xl before:bg-white/10 before:blur-xl before:animate-pulse"
          [ngStyle]="{'background': 'linear-gradient(to bottom, var(--tw-gradient-stops))'}">
          {{ level }}
        </div>
      </div>

      <!-- Progression -->
      <div class="w-full bg-gray-800 rounded-full h-6 overflow-hidden mb-4 shadow-inner">
        <div [style.width.%]="progression"
             class="h-6 rounded-full transition-all duration-700 ease-out"
             [ngStyle]="{'background': 'linear-gradient(to right, #ff5f6d, #ffc371)'}">
        </div>
      </div>

      <!-- Prochain objectif -->
      <p class="text-gray-200 text-sm mt-2 flex items-center justify-center">
        <span class="mr-2">ğŸš€</span>
        Il vous reste <strong>{{ xpRestant }}</strong> XP pour atteindre le Level <strong>{{ level + 1 }}</strong>
      </p>

      <!-- Derniers XP gagnÃ©s avec animation -->
      <div *ngIf="derniersXp.length > 0" class="mt-6 w-full text-left">
        <h3 class="text-white font-bold mb-3">Derniers XP gagnÃ©s :</h3>
        <ul class="grid grid-cols-1 gap-2">
          <li *ngFor="let result of derniersXp; let i = index"
              class="flex items-center opacity-0 translate-y-4 transform"
              [style.animation]="'fadeSlideUp 0.5s ease-out forwards'"
              [style.animationDelay]="i * 0.15 + 's'">
            <span class="bg-purple-600 hover:bg-purple-500 text-white px-3 py-1 rounded-full shadow-md transition-all duration-300">
              +{{ result.xpGagne }} XP
            </span>
            <span class="ml-3 text-gray-300 text-xs">{{ result.date | date:'short' }}</span>
          </li>
        </ul>
      </div>

    </div>

  </ng-container>

  <ng-template #loadingTemplate>
    <div class="flex flex-col items-center">
      <div class="w-12 h-12 border-4 border-purple-500 border-t-transparent rounded-full mb-2 animate-spin"></div>
      <p class="text-purple-100">Chargement des donnÃ©es...</p>
    </div>
  </ng-template>

  <ng-template #noUserTemplate>
    <p class="text-white">Aucun utilisateur connectÃ©.</p>
  </ng-template>

  <div *ngIf="errorMessage" class="text-red-400 mt-4 font-semibold">
    {{ errorMessage }}
  </div>

</div>
