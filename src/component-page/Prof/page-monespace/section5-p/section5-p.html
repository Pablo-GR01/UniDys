<app-icon></app-icon>

<!-- SECTION UTILISATEUR -->
<div class="flex flex-wrap items-center justify-between gap-4 px-4 py-6 border-4 border-[#8002FF] bg-[#0A072E] text-white rounded-xl max-w-7xl mx-auto mt-5">

  <!-- Initiales -->
  <div class="flex items-center justify-center border-2 border-[#8002FF] rounded-full font-black w-12 h-12 text-lg sm:w-14 sm:h-14 sm:text-xl lg:w-16 lg:h-16 lg:text-2xl">
    {{ getInitiales() }}
  </div>

  <!-- Bonjour + nom -->
  <div class="font-bold text-lg sm:text-xl lg:text-2xl">
    Bonjour {{ getNomComplet() }}
  </div>

  <!-- BOUTONS -->
  <div class="flex flex-wrap gap-4 justify-center">
    <button (click)="ouvrirPopupCours()"
      class="flex items-center gap-2 bg-[#8002FF] hover:bg-[#3F0255] text-white px-4 py-2 rounded transition duration-300 text-sm sm:text-base">
      <i class="fas fa-plus"></i> CrÃ©er un cours
    </button>

    <button (click)="ouvrirPopup()"
      class="flex items-center gap-2 border-4 border-[#8002FF] hover:bg-[#8002FF] text-white px-4 py-2 rounded transition duration-300 text-sm sm:text-base">
      <i class="fas fa-plus"></i> Laisser un avis
    </button>
  </div>
</div>

<!-- POPUP AVIS -->
<div *ngIf="popupOuvert" class="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4">
  <div class="relative bg-[#020118] text-white border-4 border-[#8002FF] rounded-xl shadow-xl w-full max-w-4xl p-6 flex flex-col md:flex-row gap-8 max-h-[90vh] overflow-auto">
    <button (click)="fermerPopup()" class="absolute top-2 right-4 text-white hover:text-red-600 text-3xl leading-none z-50">&times;</button>
    <div class="flex items-center justify-center md:w-1/2">
      <img src="/assets/LOGO.png" alt="Logo UniDys" class="max-w-[200px] h-auto" />
    </div>
    <div class="md:w-1/2">
      <h2 class="text-2xl font-bold mb-6 text-center md:text-left">Laisser un avis</h2>
      <input type="text" [(ngModel)]="prenom" placeholder="PrÃ©nom" class="w-full border-2 border-[#8002FF] p-3 mb-4 rounded-lg bg-transparent text-white placeholder-gray-400" />
      <input type="text" [(ngModel)]="nom" placeholder="Nom" class="w-full border-2 border-[#8002FF] p-3 mb-4 rounded-lg bg-transparent text-white placeholder-gray-400" />
      <textarea [(ngModel)]="avisMessage" placeholder="Votre message" rows="4" class="w-full border-2 border-[#8002FF] p-3 mb-4 rounded-lg bg-transparent text-white placeholder-gray-400 resize-none"></textarea>
      <div class="flex justify-end">
        <button (click)="validerAvis()" class="bg-[#8002FF] px-4 py-2 rounded-lg hover:bg-[#3F0255] transition duration-200">Valider</button>
      </div>
    </div>
  </div>
</div>

<!-- POPUP CRÃ‰ATION DE COURS -->
<div *ngIf="popupCoursOuvert" class="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4">
  <div class="bg-[#020118] rounded-2xl shadow-xl text-white w-full max-w-5xl flex flex-col md:flex-row max-h-[90vh] overflow-hidden border-4 border-[#8002FF]">
    <div class="w-full md:w-1/3 flex items-center justify-center rounded-t-2xl md:rounded-l-2xl md:rounded-tr-none p-6">
      <img src="/assets/LOGO.png" alt="Logo UniDys" class="max-w-full max-h-[200px] object-contain" />
    </div>
    <div class="w-full md:w-2/3 p-4 md:p-6 flex flex-col overflow-y-auto">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-lg sm:text-xl font-bold">Nouveau cours</h2>
        <button (click)="fermerPopupCours()" class="text-white hover:text-red-600 text-3xl leading-none">&times;</button>
      </div>
      <div *ngIf="imageMatiere" class="mb-4">
        <img [src]="imageMatiere" alt="Image matiÃ¨re" class="w-16 h-16 object-cover rounded" />
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <input [(ngModel)]="titreCours" type="text" placeholder="Titre du cours" class="border-2 border-[#8002FF] rounded px-2 py-2" />
        <input [(ngModel)]="nomProf" type="text" placeholder="Nom du professeur" class="border-2 border-[#8002FF] rounded px-2 py-2 text-gray-600" readonly />
        <select [(ngModel)]="niveau" class="border-2 text-white border-[#8002FF] rounded px-2 py-2">
          <option value="" disabled>Niveau</option>
          <option value="CP">CP</option>
          <option value="CE1">CE1</option>
          <option value="CE2">CE2</option>
          <option value="CM1">CM1</option>
          <option value="CM2">CM2</option>
        </select>
        <select [(ngModel)]="matiere" (change)="mettreAJourImage()" class="border-2 border-[#8002FF] rounded px-2 py-2 text-white">
          <option value="" disabled>MatiÃ¨re</option>
          <option>FranÃ§ais</option>
          <option>Maths</option>
          <option>Histoire</option>
          <option>Sciences</option>
        </select>
        <input [(ngModel)]="lienYoutube" type="text" placeholder="Lien Youtube (optionnel)" class="col-span-1 md:col-span-2 border-2 border-[#8002FF] rounded px-2 py-2" />
        <p *ngIf="messageErreurPdf" class="text-red-500 text-sm mt-2 col-span-2">{{ messageErreurPdf }}</p>
        <input type="file" (change)="onPdfSelected($event)" class="col-span-1 md:col-span-2 border-2 border-[#8002FF] rounded px-2 py-2" />
        <p *ngIf="fichierPdf" class="text-sm col-span-2">ðŸ“„ Fichier : {{ fichierPdf.name }}</p>
      </div>
      <div class="mt-2 flex items-center gap-2">
        <button *ngIf="qcms.length > 0" class="bg-green-800 text-white px-3 py-1 rounded-full text-sm cursor-default hover:scale-105 transition duration-200">
          {{ qcms.length }} QCM crÃ©Ã©{{ qcms.length > 1 ? 's' : '' }}
        </button>
      </div>
      <div class="mt-4">
        <button (click)="validerCours()" class="bg-[#8002FF] hover:bg-[#3F0255] px-4 py-2 rounded">+ Ajouter QCM</button>
      </div>
      <div class="mt-6 text-right">
        <button (click)="validerCours()" class="bg-[#8002FF] hover:bg-[#3F0255] px-6 py-2 rounded">Valider le cours</button>
      </div>
    </div>
  </div>
</div>
