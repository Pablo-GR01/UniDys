<!-- Logo et icône -->
<app-icon></app-icon>

<!-- Logo à gauche -->
<div class="flex-shrink-0 2xl:ml-1 mt-3">
  <a routerLink="/accueil">
    <img src="assets/LOGO.png" alt="Logo UniDys"
      class="hover:scale-105 transition-transform duration-300 w-30 sm:w-34 xl:w-38 2xl:w-42" />
  </a>
</div>

<!-- Fond principal -->
<div class="bg-[var(--Bleu-Foncé)]">
  <div class="min-h-screen flex flex-col items-center justify-center px-4 -mt-20">

    <!-- Message de bienvenue -->
    <div *ngIf="message" class="border-2 border-[var(--Violet)] text-[var(--Blanc)] rounded-2xl shadow-lg text-center font-semibold animate-fade-in 
                  text-lg md:text-xl 2xl:text-2xl px-10 py-5 mb-6 bg-[var(--Bleu)]">
      <p class="mb-0">{{ message }}</p>
    </div>

    <!-- Message d'erreur serveur -->
    <div *ngIf="errorMessage" class="border-2 border-[var(--Rouge)] text-[var(--Rouge)] rounded-2xl shadow-lg text-center font-semibold animate-fade-in 
                  text-sm md:text-base px-6 py-3 mb-4 bg-[var(--Bleu-Foncé)]">
      <p class="mb-0">{{ errorMessage }}</p>
    </div>

    <!-- Boîte de connexion -->
    <div class="bg-[var(--Bleu-Foncé)] rounded-2xl p-8 w-full max-w-md shadow-xl border-3 border-[var(--Violet)] relative">

      <!-- Titre -->
      <h2 class="text-center font-black text-[var(--Violet)] mb-6
      2xl:text-4xl xl:text-3xl md:text-3xl sm:text-2xl text-xl">
        Connexion
      </h2>

      <!-- Formulaire -->
      <form (ngSubmit)="valider()" #connexionForm="ngForm">

        <!-- Email -->
        <div class="mb-4">
          <label class="text-[var(--Blanc)] text-sm" for="email">Adresse mail</label>
          <div class="flex items-center border-2 border-[var(--Violet)] px-3 py-2 rounded mt-1">
            <i class="fa-solid fa-envelope text-[var(--Blanc)] mr-2"></i>
            <input type="email" id="email" name="email"
              class="bg-transparent outline-none text-[var(--Blanc)] w-full"
              placeholder="Adresse mail" required [(ngModel)]="connexionData.email" #email="ngModel" />
          </div>
          <!-- Message d'erreur affiché uniquement après clic -->
          <div *ngIf="formSubmitted && email.invalid" class="text-[var(--Rouge)] text-xs mt-1">
            Email invalide.
          </div>
        </div>

        <!-- Mot de passe -->
        <div class="mb-4">
          <label class="text-[var(--Blanc)] text-sm" for="password">Mot de passe</label>
          <div class="flex items-center border-2 border-[var(--Violet)] px-3 py-2 rounded-md mt-1 relative">
            <i class="fa-solid fa-lock text-[var(--Blanc)] mr-2"></i>
            <input [type]="passwordVisible ? 'text' : 'password'" id="password" name="password"
              class="bg-transparent outline-none text-[var(--Blanc)] w-full pr-10" placeholder="Mot de passe" required
              minlength="6" [(ngModel)]="connexionData.password" #password="ngModel" />
            <button type="button" class="absolute right-3 text-[var(--Blanc)]" (click)="togglePasswordVisibility()"
              aria-label="Afficher / masquer mot de passe" tabindex="-1">
              <i class="fa" [ngClass]="passwordVisible ? 'fa-eye-slash' : 'fa-eye'"></i>
            </button>
          </div>
          <!-- Message d'erreur affiché uniquement après clic -->
          <div *ngIf="formSubmitted && password.invalid" class="text-[var(--Rouge)] text-xs mt-1">
            Le mot de passe doit contenir au moins 6 caractères.
          </div>
        </div>

        <!-- Bouton valider -->
        <button type="submit" [disabled]="!formulaireValide() || isLoading"
          class="flex items-center justify-center gap-2 bg-[var(--Violet)] text-white font-semibold rounded hover:bg-[var(--Violet-Foncé)] disabled:opacity-50 transition-all duration-300
       w-full min-w-[250px] py-2 px-6 sm:px-10 md:px-20 lg:px-28 xl:px-36 2xl:px-40">
          <span class="inline-block">
            {{ isLoading ? 'Connexion...' : 'Valider' }}
          </span>
        </button>

      </form>

      <!-- Lien inscription -->
      <p class="text-center text-sm text-[var(--Blanc)] mt-6">
        Vous n'avez pas encore de compte ?
        <a routerLink="/inscription" class="text-[var(--Violet)] font-semibold hover:underline transition duration-200">
          Créer un compte
        </a>
      </p>
    </div>
  </div>
</div>
